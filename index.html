<!DOCTYPE HTML>
<HTML>
	
	<head>
		
		<title>ReactDashboard</title>
		
		<script src="js/react.js"></script>
		<script src="js/JSXTransformer.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
		
		<link type="text/css" rel="stylesheet" href="css/materialize.min.css"  media="screen,projection"/>
		<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
		
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
		
		<script type="text/javascript" src="js/materialize.min.js"></script>
		
	</head>
	
	<body>
		
		<div id="inventory-dashboard" class="container"></div>
		
	</body>
	
	<script type="text/jsx">
	var ProductList = React.createClass({
		getInitialState: function() {
			return {data: []};
		},
		componentDidMount: function() {
			$.ajax({
				url:this.props.url,
				dataType: 'json',
				cache: false,
				success: function(data) {
					this.setState({data: data});
				}.bind(this),
				error: function(xhr,status, err){
					console.error(this.props.url, status, err.toString());
				}.bind(this)
			});
		},
		render: function() {
			return (
				<div className="row">
					<div className="productList">
						<h1 className="teal-text">Products</h1>
						<Product data={this.state.data}></Product>
					</div>      
				</div>
			);
		}
	});
	var SearchedProduct = React.createClass({
		render: function() {
			var productNodes = this.props.data.map(function (product) {
				return (	
					<div className="col s4">
						<div className="card-panel hoverable">
							<div className="product">
								<span className="right teal-text">{product.item_units} units</span>
								<h5 className="truncate">{product.item_name}</h5>
								<p className="truncate">{product.item_description}</p>
								<span className="right chip">{product.item_type}</span>
								<b>Rs.</b>{product.item_price} per unit.<br/>
							</div>
						</div>
					</div>
					
				);
			});
			return (
				<div className="searching-product">
					{productNodes}
				</div>
			);
		}
	});	
	
	var Product = React.createClass({
		doSearch:function(queryText){
			console.log(queryText)		
				var queryResult = [];
			
			this.props.data.forEach(function(product){
				if(product.item_name.toLowerCase().indexOf(queryText)!=-1)
					queryResult.push(product);
				console.log(queryResult)
				
			});
			
			this.setState({
				query: queryText,
				filteredData: queryResult
			})
		},
		
		getInitialState:function(){
			return {
				query: '',
				filteredData: this.props.data
			}
		},
		
		render: function() {
			return (
				<div className="products">
					<SearchBox query={this.state.query} doSearch={this.doSearch}/>
					<SearchedProduct data={this.state.filteredData}/>
				</div>
			);
		}
	});

	var SearchBox = React.createClass({
		doSearch:function(){
			var query = this.refs.searchInput.getDOMNode().value;
			this.props.doSearch(query);
		},
		render:function(){
			return (
				<div className="row">
					<div className="col s6">
						<input type="text" placeholder="Search Products" ref="searchInput" value={this.props.query} onChange={this.doSearch}/> <span className="material-icons">search</span>
					</div>
				</div>);
			
		}
	});
	
	React.render(
		<ProductList url="http://127.0.0.1:5000/products" />,
		document.getElementById('inventory-dashboard'));
	
	</script>  
	
</HTML>
